USE [PNC]
GO
/****** Object:  UserDefinedFunction [dbo].[fn_Dividir]    Script Date: 26/11/2021 15:05:16 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER FUNCTION [dbo].[fn_Dividir] (@NUMERADOR FLOAT, @DENOMINADOR FLOAT, @PORCENTAGEM INT = 0)
RETURNS VARCHAR(100)
AS
BEGIN 

    DECLARE	@RETORNO	FLOAT
			,@PORCENT	FLOAT
    
	SET @PORCENT = CASE WHEN @PORCENTAGEM = 0 THEN 1.0 
						WHEN @PORCENTAGEM = 1 THEN 100.0
						WHEN @PORCENTAGEM = 2 THEN 100.0
						END
	SET @RETORNO = CASE WHEN @DENOMINADOR IS NULL OR @DENOMINADOR = 0 THEN NULL
						WHEN @PORCENTAGEM = 2 THEN CONVERT(DECIMAL(38,2),((@NUMERADOR / @DENOMINADOR)-1) * @PORCENT)
						ELSE CONVERT(DECIMAL(38,2),(@NUMERADOR / @DENOMINADOR) * @PORCENT)
						END

	RETURN CONVERT(VARCHAR,@RETORNO)

END

